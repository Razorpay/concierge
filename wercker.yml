box:
  id: razorpay/docker:php7

build:
    services:
      - id: mysql
        tag: latest
        env:
          MYSQL_ROOT_PASSWORD: root
          MYSQL_DATABASE: root
    steps:
      - script:
          name: install dependencies
          code: composer install --no-interaction
    after-steps:
      - slack-notifier:
          url: $SLACK_URL
          channel: tech_bots
          username: wercker
          icon_url: https://cdn.rawgit.com/wantedly/step-pretty-slack-notify/master/icons/$WERCKER_RESULT.jpg
deploy:
    steps:
      - nhuray/aws-code-deploy:
          key: $AWS_KEY
          secret: $AWS_SECRET
          region: $AWS_REGION
          application-name: concierge
          deployment-group-name: $WERCKER_DEPLOYTARGET_NAME
          s3-bucket: rzp-code-deploy
    after-steps:
      - slack-notifier:
          url: $SLACK_URL
          channel: tech_bots
          username: wercker
          icon_url: https://cdn.rawgit.com/wantedly/step-pretty-slack-notify/master/icons/$WERCKER_RESULT.jpg
